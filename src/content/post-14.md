---
title: "Nestjs testing"
date: "2021-10-12"
draft: true
path: "/blog/nestJSTesting"
---

```javascript
npm i --save-dev @nestjs/testing
```

mocking spying

구성 요소에 대한 기본 단위 테스트 및 애플리케이션에 대한 e2e 테스트 기본뼈대를 모듈이나 컨트롤러 생성시 자동으로 구성합니다.
기본 도구 제공(예: 격리된 모듈/애플리케이션 로더를 빌드하는 테스트 실행기)
Jest 및 Supertest와의 통합을 즉시 제공하는 동시에 테스트 도구에 대해 독립적입니다.
구성 요소를 쉽게 모의하기 위해 테스트 환경에서 Nest 종속성 주입 시스템을 사용할 수 있습니다.
언급했듯이 Nest는 특정 도구를 강제하지 않으므로 원하는 테스트 프레임워크를 사용할 수 있습니다. 필요한 요소(예: 테스트 실행기)를 교체하기 만하면 Nest의 기성 테스트 시설의 이점을 계속 누릴 수 있습니다.

testing 패키지를 설치해야한다/

기본테스트 프레임워크는 Jest이다.

```javascript
describe('message', ()=>{테스트 코드 작성})
```

방법이 두가지 있다. new로 선언해서 사용하는 방법과 테스트 모듈을 사용해서 하는 것 nest 기능을 사용하려면 테스트 모듈을 사용해야한다.
Test 클래스는 기본적으로 전체 Nest 런타임을 모의하는 애플리케이션 실행 컨텍스트를 제공하는 데 유용하지만 모킹 및 재정의를 포함하여 클래스 인스턴스를 쉽게 관리할 수 있는 후크를 제공합니다Test 클래스에는 모듈 메타데이터 객체를 인수로 사용하는 createTestingModule() 메서드가 있습니다 (@Module() 데코레이터에 전달하는 동일한 객체).이 메서드는 몇가지 메서드를 제공하는 TestingModule 인스턴스를 반환합니다. 단위 테스트에서 중요한 것은 compile() 메서드입니다. 이 메소드는 의존성이 있는 모듈을 부트스트랩하고(애플리케이션이 NestFactory.create()를 사용하여 기존 main.ts 파일에서 부트스트랩되는 방식과 유사함) 테스트할 준비가 된 모듈을 반환합니다.
compile() 메서드는 비동기이므로 기다려야 합니다. 모듈이 컴파일되면 get()메서드를 사용하여 선언하는 정적 인스턴스(컨트롤러 및 프로바이더)를 검색할 수 있습니다.

TestingModule은 모듈 참조 클래스에서 상속되므로 범위가 지정된 프로바이더(임시 또는 요청 범위)를 동적으로 확인하는 기능입니다. resolve() 메서드를 사용하여 이 작업을 수행합니다(get() 메서드는 정적 인스턴스만 검색할 수 있음).resolve() 메서드는 자체 DI 컨테이너 하위 트리에서 프로바이더의 고유한 인스턴스를 반환합니다. 각 하위 트리에는 고유한 컨텍스트 식별자가 있습니다. 따라서 이 메서드를 두번 이상 호출하고 인스턴스 참조를 비교하면 같지 않음을 알 수 있습니다.

모듈참조클래스를 제공하여

TestingModule은 모듈 참조 클래스에서 상속되므로 범위가 지정된 프로바이더(임시 또는 요청 범위)를 동적으로 확인하는 기능입니다. resolve() 메서드를 사용하여 이 작업을 수행합니다

E2E 테스트는 환경에 의존하는 테스트이지만, 단위 테스트는 실행 중인 환경에 의존하면 안 되고, 빠르게 실행되어야 한다. E2E 테스트에서는 보통 테스트 데이터베이스를 사용하고, 테스트의 신뢰성이 높지만 속도가 느리다는 단점이 있다.
